---
title: "Module03: Reading text files"
author: "Steve Simon"
date: "Created 2020-02-08"
output: powerpoint_presentation
---

```{r echo=FALSE}
suppressMessages(suppressWarnings(library(stringr)))
options(width=45)
```

### Text files
+ Advantages
  + Easy import into many programs
  + Review using notepad
+ Wide range of formats
  + Delimited
  + Fixed width
+ First row for variable names
  + Optional but recommended
+ Always look for a data dictionary

<div class="notes">

One of the most important skils you will learn in this class is how to read data from text files. Text files are commonly used for data storage because they are easily imported into a variety of different programs. You can often peek at a text file using a simple program like Notepad in order to get a quick feel for what the data looks like.

Text files come in a variety of format. A delimited file uses a special character, often a comma, to designiate where one data value ends and the next one begins. In contrast, a fixed width file requires every variable to occupy a particular column or columns.

Many text files include the names of the variables in the first row of text. This is not required, but it is strongly recommended.

</div>

### Read in comma separated values

+ Type the following into notepad.

```{r csv, echo=FALSE, comment=""}
tx <- readLines("../dat/simple.csv")
cat(tx, sep="\n")
```

+ Save it
  + in the dat directory
  + filename: simple.csv

<div class="notes">

In notepad or another text editor, type in the following
values.

x,y

1,4

2,8

3,12

4,16

and save the file using the name simple.csv. Note the directory that you are saving it in. Ideally, it should be in a folder named "dat."


</div>

### the read.csv function 

```{r read-csv}
fn <- "../dat/simple.csv"
raw_data <- read.csv(file=fn, 
  stringsAsFactors=FALSE)
raw_data
```

<div class="notes">

Comma separated files are so common that R has several dedicated functions for reading them. The simplest function is read.csv. It The best fuctions are in the readr library.

We will not talk about it in this module, but you almost always want to use the option stringsAsFactors=FALSE.

</div>

### Space delimited files

+ Type the following into notepad.

```{r space-delimited, echo=FALSE, comment=""}
tx <- readLines("../dat/simple.txt")
cat(tx, sep="\n")
```

+ Save it
  + in the dat directory
  + filename: simple.txt

<div class="notes">

Now try something different. Type in the same data, but use a single space between each number rather than a comma.

</div>

### Using the read.table function

```{r txt}
fn <- "../dat/simple.txt"
raw_data <- read.table(fn, header=TRUE, stringsAsFactors=FALSE, sep=" ")
raw_data
```

<div class="notes">

Review the options for the read.table command.

Type in the same data, but using the tilde (~) as a separator (e.g., 1~4). Save the file as tilde.txt.

Here is how you would use read.table to read this file.

</div>

### Tab delimited files

+ Type the following into notepad, but everywhere you see a space, press the tab key instead of the space bar.

```{r tab, echo=FALSE, comment=""}
tx <- readLines("../dat/simple.tsv")
cat(tx, sep="\n")
```

+ Save it
  + in the dat directory
  + filename: simple.tsv

<div class="notes">

</div>

### Using the read.table function

```{r tsv}
fn <- "../dat/simple.tsv"
raw_data <- read.table(fn, header=TRUE, stringsAsFactors=FALSE, sep="\t")
raw_data
```

### Anything can be a delimiter

+ Type the following into notepad

```{r anything, echo=FALSE, comment=""}
tx <- readLines("../dat/tilde.txt")
cat(tx, sep="\n")
```

+ Save it
  + in the dat directory
  + filename: tilde.txt


<div class="notes">

Type in the same data, but using the tilde (~) as a separator (e.g., 1~4). Save the file as tilde.txt.

Here is how you would use read.table to read this file.

</div>

### Using the read.table function

```{r tilde}
fn <- "../dat/tilde.txt"
raw_data <- read.table(fn, header=TRUE, stringsAsFactors=FALSE, sep="~")
raw_data
```

<div class="notes">

The data reads in just fine. Why would you use a tilde as a delimiter. Sometimes your data itself includes delimiters like spaces and commas, and then you might want to choose an obscure out of the way symbol to serve as a delimiter.

</div>

### Reading fixed width format files

+ Type the following into notepad
  + Space between the 1 and 4
  + Space between the 2 and 8
  + No space between the 3 and 12
  + No space between the 4 and 16

```{r fixed, echo=FALSE, comment=""}
tx <- readLines("../dat/fixed.txt")
cat(tx, sep="\n")
```

+ Save it
  + in the dat directory
  + filename: fixed.txt


<div class="notes">

Here's another variation.

Sometimes you will get a file with no delimiters to save space. This requires that each variable takes up a fixed number of columns and that information is often specified in a separate file.

Create a fixed width file in notepad with the following lines.

1 4

2 8

312

416

and store it as fixed.txt.

</div>

### The read.fwf function 

```{r read.fwf}
fn <- "../dat/fixed.txt"
raw_data <- read.fwf(fn, c(1, 2))
raw_data
```

<div class="notes">

You should also consider the read.fortran function. Check out the help file.

</div>

### Writing text files

If you want to write a text file, you can use either the write.csv or write.table functions. Look up the help files on these functions. We'll create a small data frame and store it in a comma delimited and tab delimited format.

</div>

### Writing text files 

```{r write-text}
raw_data <- data.frame(x=c(1, 2, 3, 4), y=c(4, 8, 12, 16))
fn <- "../results/output_data.txt"
write.table(raw_data, fn, row.names=FALSE)
```

<div class="notes">

Open these files in notepad to see what they look like.

</div>

### Writing text files

```{r output1, echo=FALSE}
tx <- readLines(fn)
cat(tx, sep="\n")
```

<div class="notes">

If you opened up the data in notepad or some other program, you would see a space delimited file. You can change the delimiter, among other things

</div>

### Example #1

+ https://stats.idre.ucla.edu/stat/data/binary.csv

```{r ex1, echo=FALSE}
fn <- "https://stats.idre.ucla.edu/stat/data/binary.csv"
tx <- readLines(fn)
cat(tx[1:6], sep="\n")
```

<div class="notes">

Here is the first real-world example. Peeking at the first six lines of data, you can see clearly that it is uses comma delimiter and the first row of data contains the variable names.

</div>


### Example #1

+ No formal data dictionary, but here is a description
  + "This dataset has a binary response (outcome, dependent) variable called admit. There are three predictor variables: gre, gpa and rank. We will treat the variables gre and gpa as continuous. The variable rank takes on the values 1 through 4. Institutions with a rank of 1 have the highest prestige, while those with a rank of 4 have the lowest."
  + Description found at https://stats.idre.ucla.edu/r/dae/logit-regression/
  
<div class="notes">

There is no formal data dictionary, which is a shame, but you can find a brief description on a second page where this data set is used.

</div>

### Example #1

```{r read-binary}
fn <- "https://stats.idre.ucla.edu/stat/data/binary.csv"
mydata <- read.csv(fn, stringsAsFactors=FALSE)
head(mydata)
```

<div class="notes">

The read.csv file does a fine job here. I am only printing the first few rows of the data.

</div>

### Example #2

![](../images/barbershop-in-notepad.png)

<div class="notes">

This is a second dataset. Looking at it in notepad, it looks like it is a tab delimited file.

</div>

### Example #2

+ No data dictionary
  + Brief description: "At a barbershop music singing competition, choruses are judged on three scales: Music (quality of the arrangement, etc.), Performance, and Singing."
  + Description found at https://dasl.datadescription.com/datafile/barbershop-music/

### Example #2

```{r read-tsa-3}
fn <- "https://dasl.datadescription.com/download/data/3061"
mydata <- read.table(
  fn, header=TRUE, sep="\t", 
  stringsAsFactors=FALSE)
head(mydata)
```

<div class="notes">

The read.table command works well here. The separator or delimiter is the tab character, which is coded in R as \t.

</div>

### Example #3

![](../images/airport-in-browser.png)

<div class="notes">

This is a third data set. Notice that there are no variable names at the top of the file.

</div>

### Example #3

+ Data dictionary at http://jse.amstat.org/datasets/airport.txt. Here is an excerpt.

```{}
VARIABLE DESCRIPTIONS:
Airport                          Columns 1-21
City                             Columns 22-43 
Scheduled departures             Columns 44-49 
Performed departures             Columns 51-56
Enplaned passengers              Columns 58-65
Enplaned revenue tons of freight Columns 67-75
Enplaned revenue tons of mail    Columns 77-85
```

<div class="notes">

This dataset has a very nice data dictionary. From the description, you can tell that it is a fixed width format.

</div>

### Example #3

```{r airport}
fn <- "http://jse.amstat.org/datasets/airport.dat.txt"
raw_data <- read.fwf(fn, 
  c(21, 22, 6, 7, 9, 10, 10), header=FALSE)
head(raw_data, 2)
```

### Some recommendations
