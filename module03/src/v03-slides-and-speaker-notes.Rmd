---
title: "Module03: Reading text files"
author: "Steve Simon"
date: "Created 2020-02-08"
output: powerpoint_presentation
---

```{r echo=FALSE}
suppressMessages(suppressWarnings(library(stringr)))
options(width=45)
```

### Text files
+ Advantages
  + Easy import into many programs
  + Review using notepad
+ Wide range of formats
  + Delimited
  + Fixed width
+ First row for variable names
  + Optional but recommended
+ Always look for a data dictionary

<div class="notes">

One of the most important skils you will learn in this class is how to read data from text files. Text files are commonly used for data storage because they are easily imported into a variety of different programs. You can often peek at a text file using a simple program like Notepad in order to get a quick feel for what the data looks like.

Text files come in a variety of format. A delimited file uses a special character, often a comma, to designiate where one data value ends and the next one begins. In contrast, a fixed width file requires every variable to occupy a particular column or columns.

Many text files include the names of the variables in the first row of text. This is not required, but it is strongly recommended.

</div>

### Read in comma separated values

+ Type the following into notepad.

```{r csv, echo=FALSE, comment=""}
tx <- readLines("../dat/simple.csv")
cat(tx, sep="\n")
```

+ Save it
  + in the dat directory
  + filename: simple.csv

<div class="notes">

In notepad or another text editor, type in the following
values.

x,y

1,4

2,8

3,12

4,16

and save the file using the name simple.csv. Note the directory that you are saving it in. Ideally, it should be in a folder named "dat."


</div>

### the read.csv function 

```{r read-csv}
fn <- "../dat/simple.csv"
raw_data <- read.csv(file=fn, 
  stringsAsFactors=FALSE)
raw_data
```

<div class="notes">

Comma separated files are so common that R has several dedicated functions for reading them. The simplest function is read.csv. It The best fuctions are in the readr library.

We will not talk about it in this module, but you almost always want to use the option stringsAsFactors=FALSE.

</div>

### Space delimited files

+ Type the following into notepad.

```{r space-delimited, echo=FALSE, comment=""}
tx <- readLines("../dat/simple.txt")
cat(tx, sep="\n")
```

+ Save it
  + in the dat directory
  + filename: simple.txt

<div class="notes">

Now try something different. Type in the same data, but use a single space between each number rather than a comma.

</div>

### Using the read.table function

```{r txt}
fn <- "../dat/simple.txt"
raw_data <- read.table(fn, header=TRUE, stringsAsFactors=FALSE, sep=" ")
raw_data
```

<div class="notes">

Review the options for the read.table command.

Type in the same data, but using the tilde (~) as a separator (e.g., 1~4). Save the file as tilde.txt.

Here is how you would use read.table to read this file.

</div>

### Tab delimited files

+ Type the following into notepad, but everywhere you see a space, press the tab key instead of the space bar.

```{r tab, echo=FALSE, comment=""}
tx <- readLines("../dat/simple.tsv")
cat(tx, sep="\n")
```

+ Save it
  + in the dat directory
  + filename: simple.tsv

<div class="notes">

</div>

### Using the read.table function

```{r tsv}
fn <- "../dat/simple.tsv"
raw_data <- read.table(fn, header=TRUE, stringsAsFactors=FALSE, sep="\t")
raw_data
```

<div class="notes">

Review the options for the read.table command.

Type in the same data, but using the tilde (~) as a separator (e.g., 1~4). Save the file as tilde.txt.

Here is how you would use read.table to read this file.

</div>

### Reading fixed width format files

```{r fixed, echo=FALSE, comment=""}
tx <- readLines("../dat/fixed.txt")
cat(tx, sep="\n")
```

<div class="notes">

Sometimes you will get a file with no delimiters to save space. This requires that each variable takes up a fixed number of columns and that information is often specified in a separate file.

Create a fixed width file in notepad with the following lines.

1 4

2 8

312

416

and store it as fixed.txt.

</div>

### New slide 

```{r read.fwf}
fn <- "../dat/fixed.txt"
raw_data <- read.fwf(fn,c(1,2))
raw_data
```

<div class="notes">

You should also consider the read.fortran function. Check out the help file.

### Writing text files

If you want to write a text file, you can use either the write.csv or write.table functions. Look up the help files on these functions. We'll create a small data frame and store it in a comma delimited and tab delimited format.

</div>

### New slide 

```{r write-text}
d5 <- data.frame(x=c(13,12,11),y=c(2,4,6))
fn <- "../results/output1.csv"
write.csv(d5,fn)
fn <- "../results/output2.txt"
write.table(d5,fn)
```

<div class="notes">

Open these files in notepad to see what they look like.

</div>

### On your own (do this, but you do not need to turn it anything to me)

To avoid the extra line at the top and the row names "1","2","3" use the options header=FALSE and col.names=FALSE. Try this and see what the two files look like now.

### Writing binary files

By default, R saves everything that you create on exiting from the program and stores it in a file with no name and with an extension of RData (in other words, .RData). This file is automatically loaded the next time you start R from the same subdirectory.

If you want to save a data frame in binary format, use the function save(). Binary formats are much faster but are pretty much useful only within R itself.

In other words, don't send a binary file to someone who does not have R. Binary files are useful when you are moving data from one R user to another, or data from one computer to another, or sometimes when you are moving data from one folder to another.


I had a student ask, “What, exactly, do I need to turn in for the homework assignments. I said that I’d like to see the R commands, the R output, and a brief commentary. Then I realized that it might be helpful to see a real example. So I made up a simple homework assignment to illustrate what I’m looking for.

### Assignment

1. Read in the data on various body measurements. A description is at
--> http://www.amstat.org/publications/jse/datasets/fat.txt
and the file can be found at 
--> http://www.amstat.org/publications/jse/datasets/fat.dat.txt
Display the first few rows and the last few rows of the data.

2. List all of the bmi values.

3. List the last row of the data set only.

4. Calculate a summary for bmi.

5. Draw a histogram for bmi and interpret it.

6. Show the association between age and bmi using a correlation.

Here's how you would do this using R Markdown and an html format.

### Answer to 1.

Here are the R commands to read in the file.

### New slide 

```{r q1}
fn <- "http://www.amstat.org/publications/jse/datasets/fat.dat.txt"
fd <- read.table(file=fn)
```

<div class="notes">

Here are the first few rows of the data set.

</div>

### New slide 

```{r q1a}
head(fd)
```

<div class="notes">
Here are the last few rows of the data set.

</div>

### New slide 

```{r q1b}
tail(fd)
```

<div class="notes">

### Answer to 2. 

Here are all the bmi values.

</div>

### New slide 

```{r q2}
names(fd) <- c("case","fat.b","fat.s","dens","age","wt","ht","bmi","ffw","neck","chest","abdomen","hip","thigh","knee","ankle","biceps","forearm","wrist")
fd$bmi
```

<div class="notes">

### Answer to 3.

Here is the last row of the data.

</div>

### New slide 

```{r q3}
fd[252, ]
```

<div class="notes">

### Answer to 4. 

Here is a summary for bmi.

</div>

### New slide 

```{r q4}
summary(fd$bmi)
```

<div class="notes">

[[NOTE: INTERPRETATION IS IMPORTANT, BOTH HERE AND FOR THE NEXT TWO QUESTIONS. You don't have to describe every single number, just pick two or three to talk about.]] Rounding to two significant figures, the mean is 25, the range is 18 to 49.

### Answer to 5. 

Here is a histogram for bmi.

</div>

### New slide ```{r q5}
hist(fd$bmi)
```

<div class="notes">

The distribution is slightly skewed with a possible outlier between 45 and 50.

### Answer to 6.

Here is a correlation between bmi and age.

</div>

### New slide 

```{r q6}
cor(fd$bmi, fd$age)
```

<div class="notes">

The correlation is 0.12. There is little or no association between bmi and age.

Concluding remarks. What you see here is only a suggestion. Feel free to create a format that you like. The three things I am looking for is a listing of the R commands that you used, the text or graphical output, and a brief interpretation.

I noticed several of the students having trouble with adding a smooth curve to a scatterplot, and it really isn't their fault. I have been using R forclose to fiften years, which is mostly good, but it is bad because I tend to use approaches that worked with early versions of R rather than more recent approaches. I guess the term for this is that I'm "old school". But this old can learn a few new tricks, so let me explain why the old school approach to adding a smooth curve is sub-optimal and how the new approach using the ggplot2 library is better.

First, you need to download the ggplot2 package.

</div>

### New slide 

```{r download-ggplot2, eval=FALSE}
# You only need to do this once, then put eval=FALSE in the line above from that point onward.
install.packages("ggplot2")
```

<div class="notes">

There are two functions built into R for scatterplot smoothing. The first is lowess and the second is loess. Both use a locally weighted average and you control the degree of smoothness by varying the size of the window. A wide window does a lot of smoothing and a narrow window does much less smoothing.

The programs work okay, but are suboptimal for several reasons.

1. They will sometimes choke on data sets with lots of ties among the independent variables.

2. They will sometimes choke on data sets with missing values.

3. They do not have a data= argument in variable list, forcing you to type the data frame name twice.

4. They do not plot well if your data is not sorted properly. Here's a quick example of some of the problems you might see.

</div>

### New slide 

<div class="notes">

The sleep in mammals data set offers a nice example of why lowess and loess are suboptimal.

</div>

