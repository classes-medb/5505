---
title: "Introduction to R, part 1d"
author: "Steve Simon"
date: "Monday, August 10, 2016"
output: html_document
---

This program is part of a series of R programs for the Introduction to R class. This program shows you how to calculate some simple summary statistics.

```{r r-version-and-current-date}
R.version.string
Sys.Date()
```

If you need to, you can clean house and then re-load the data that you created earlier.

```{r load-data}
ls()
rm(list=ls())
load("part1.RData")
ls()
```

When you first encounter any data set, you should run some simple univariate statistics and graphics on any column of data that you plan to use in any of your analyses. In this data set, all the variables are continuous, and the summary function works well.

```{r summary}
summary(fd2$fat.b)
summary(fd2$ht)
```

## On your own

Calculate a summary for bmi.

What happens if you ask for a summary of the entire data frame? (summary(fd2)).

# Part 1e. Missing values

Notice that the summary function for the ht variable notes that one of the values is missing. You should watch these missing values obsessively. This can get a bit tricky. 

```{r tracking-missing-1}
which(fd2$ht==NA)
```

Logic involving missing values is tricky. If you checking for equality and one of the things in the comparison is missing, then the result is neither TRUE, not FALSE, but rather missing.

Fair enough, but R takes it a bit further, and if both sides when you are checking for equality are missing, then they might both be 5 is they weren't missing or maybe one might be 5 and the other one 10. So it might be TRUE or it might be FALSE, so we're better off calling the logical result as missing.

This is called a three valued logic system and it has advantages and disadvantages. I won't get into any technical details, except to say that you should never make assumptions. Check what you do when you are working with missing values to make sure that the three valued logic system doesn't produce results that you didn't expect.

The short term solution to the above problem is to use a special function, is.na.

```{r tracking-missing-2}
which(is.na(fd2$ht))
```

The summary function will trap and remove missing values, but most other functions in R will, by default, report a result as missing if any values going into that function are missing. The philosophy in R, I suppose, is that you need to actively select an approach for handling missing values rather than relying on a lazy default. Also, a  missing value is less likely to evade your notice when you have to actively specify an approach for handling the missing values.

```{r mean-sd-1}
mean(fd2$ht)
sd(fd2$ht)
```

Read the help file for these functions (enter ?mean or ?sd at the command prompt).

Look carefully and note that the na.rm option allows you to compute the statistic after missing values are removed.

```{r mean-sd-2}
mean(fd2$ht,na.rm=TRUE)
sd(fd2$ht,na.rm=TRUE)
```

For univariate functions, there are only two realistic ways to handle missing values, but for bivariate and multivariate function, there are a multitude of approaches, such as pairwise deletion, listwise deletion, last observation carried forward, single imputation, and multiple imputation. There is a lot of controversy over various methods for handling missing values.

# Part 1f. Histograms

A histogram is also useful for displaying a continuous variable graphically.

```{r histogram-1}
hist(fd2$bmi)
```

Look at the help function for the hist function. The breaks argument allows you to control where the bars appear and how many bars you have. So, for example, the default scaling for the ht variable is 2 inches per bar, but you can make the bars narrower (one inch per bar), start at 60 inches (5 feet), and go all the way up to 84 inches (7 feet).

Always start with the default option, but don't settle for it.

```{r histogram-2}
hist(fd2$ht)
```

The main, xlab, and ylab argument control some of the documentation displayed on the graph.

```{r histogram-3}
hist(fd2$ht,breaks=60:84,main=" ",xlab="Height in inches")
```

Finally, you can control the labelling of the axes by specifying axes=FALSE (to avoid the default axes, and then using the axis command to put the tick marks and labels where you want them).

```{r histogram-4}
hist(fd2$ht,breaks=c(60,66,72,78,84),main=" ",xlab="Height",axes=FALSE)
lb <- c("5ft to 5ft 6in","5ft 7in to 6ft",
        "6ft to 6ft 6in","6ft 7in to 7ft")
axis(side=1,at=c(63,69,75,81),labels=lb)
axis(side=2,at=50*(0:4))
```

## On your own

Draw a histogram for a different variable. Change the breakpoints from the default choice to one you think might be better.

# Part 1g. Saving pieces of your output using cut and paste

You can cut and paste from R to any other program that supports cut and paste. Highlight the output from one of the summary functions and copy it to the clipboard using the menu (EDIT | COPY) or the keyboard shortcut Ctrl-C. Then paste it into Word, then Excel, then Powerpoint.

Click on the menu in the graph window to copy your current graph into the clipboard. Paste the graph into Word, Excel, and Powerpoint.

# Part 1h. Correlations

The correlation coefficient is a single number between -1 and +1 that quantifies the strength and direction of a relationship between two continuous variables. As a rough rule of thumb, a correlation larger than +0.7 indicates a strong positive association and a correlation smaller than -0.7 indicates a strong negative association. A correlation between +0.3 and +0.7 (-0.3 and -0.7) indicates a weak positive (negative) association. A correlation between -0.3 and +0.3 indicates little or no association.

Don't take these rules too literally. You're not trying to make definitive statements about your data set. You are just trying to get comfortable with some general patterns that occur in your data set. A complex and definitive statistical analysis will almost certainly not agree with at least some of the preliminary correlations noted here.

```{r corr-1}
cor(fd2$fat.b,fd2$age)
```

## Correlation matrices

You can get a matrix of correlations for every possible pair of variables. This command becomes a bit more complicated if there are some categorical variables in your data set, as you need to exclude these prior to calculating the correlation matrix. Since you are just trying to get a general feel for your data, a bit of rounding will help you. Also, you should remove the case number before calculating the correlation matrix.

```{r corr-2}
round(100*cor(fd2[,-1]))
```

You can get pieces of the correlation matrix by supplying pieces of the data frame.

```{r corr-3}
leg.measures <- c("hip","thigh","knee","ankle")
arm.measures <- c("biceps","forearm","wrist")
round(cor(fd2[,leg.measures],fd2[,arm.measures]),2)
```

# Part 1i. Scatterplots

The best graphical way to display a relationship between two continuous variables is a scatterplot.

```{r scatterplot-1}
plot(fd2$abdomen,fd2$fat.b)
plot(fd2$ht,fd2$abdomen)
```

There are lots of options available to customize your graph. Here are just a few. The xlab and ylab arguments in the plot function control what is displayed on the horizontal (x) and vertical (y) axes. The pch argument control what is used as the plotting character.

```{r scatterplot-2}
plot(fd2$abdomen/2.54,fd2$fat.b,
     xlab="Abdomen circumference in inches",
     ylab="Percentage of body fat using Brozek's equation",
     pch="+")
```

Notice that you can do the units conversion "on the fly". This doesn't
work on all functions.

## Adding trend lines

These scatterpltos often benefit by adding a trend line.

Here's a linear regression trend line

```{r trend-1}
fd2$abdomen.in <- fd2$abdomen/2.54
trend.line <- lm(fat.b~abdomen.in,data=fd2)
plot(fd2$abdomen.in,fd2$fat.b)
abline(trend.line)
```

Here's a smooth curve.

```{r trend-2}
smooth.curve <- lowess(fd2$age,fd2$fat.b)
plot(fd2$age,fd2$fat.b)
lines(smooth.curve)
```

## Try all of these things on a totally different data set.

There is a second data set on sleep in mammals. You can find a brief description of this data set at

--> http://www.statsci.org/data/general/sleep.html

and you can download the actual data at

--> http://www.statsci.org/data/general/sleep.txt

Notice that the last three variables are ordinal, but for the purposes of this class, we will treat them the same as the other variables.

## Read the file into R

Notice that this file has variable names at the very top. Look at the help file for read.table and see what option you might choose here. Display the first few rows and the last few rows.

As noted in each of the R commands shown below, I will remove the answers before I distribute this file to the students.

```{r read-sleep}
fn <- "http://www.statsci.org/data/general/sleep.txt"
sl <- read.table(file=fn,header=TRUE)
head(sl)
tail(sl)
```

## On your own

1. Notice that there is a huge range in body weight. Display the information for the smallest and the largest mammals.

2. Which variables have missing data?

3. Calculate the mean and standard deviation for TotalSleep.

4. Draw a histogram for the BodyWt variable. Note that this variable is highly skewed. Re-draw the histogram on the log scale. Hint: log(sl$BodyWt,base=10). For exta credit, relabel the axes with values at 0.001,0.01, etc.

5. Calculate the ratio of BrainWt to BodyWt and express it as a percentage. Be sure to convert grams to kilograms (or vice versa) before computing the ratio. What animal has the smallest/largest ratio?

6. Do bigger animals sleep longer or live longer? Show your results using a correlation coefficient.

7. Do animals who have high degrees of Predation, Exposure, or Danger sleep less? Show your results using a plot and a trendline.

8. Place all the key results into a Word document, add a bit of commentary, and turn it in by email. Use the subject line: "Introduction to R, Part 1 Exercises"

## If there is time.

If there is time, a third data set is described at

--> http://www.amstat.org/publications/jse/datasets/body.txt

and the data itself is at

--> http://www.amstat.org/publications/jse/datasets/body.dat.txt

## Save everything we've done so far

```{r save-image}
save.image("part1.RData")
```
